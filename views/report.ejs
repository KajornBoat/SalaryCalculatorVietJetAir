<!doctype html>
<html lang="en">

<head>
    <title>Salary Calculator VeitJet Thailand</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#712cf9">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        body {
            position: relative;
        }

        .b-example-divider {
            width: 100%;
            height: 3rem;
            background-color: rgba(0, 0, 0, .1);
            border: solid rgba(0, 0, 0, .15);
            border-width: 1px 0;
            box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
        }

        #loading {
            position: fixed;
            z-index: 100;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
        }

        #loading-span {
            position: fixed;
            height: max-content;
            width: max-content;
            margin: auto;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
        }
    </style>
</head>



<body class="bg-body-tertiary">

    <div class="content">
        <div class="container">
            <main>
                <br>
                <div class="container">
                    <h2>AMITA SUKPHAN</h2>
                    <p class="lead">Employee Code : TVJ2019</p>
                </div>

                <hr>
                <div class="row g-5">

                    <div class="col-md-7 col-lg-8">
                        <!-- Select Date -->
                        <form id="select-date">
                            <h4 class="mb-3">Select Date</h4>
                            <div class="row g-3">
                                <div class="col-sm-6">
                                    <label for="date-from" class="form-label">From</label>
                                    <input type="date" class="form-control" id="date-from" required>
                                </div>

                                <div class="col-sm-6">
                                    <label for="date-to" class="form-label">To</label>
                                    <input type="date" class="form-control" id="date-to" required>
                                </div>

                            </div>

                            <br>
                            <button class="w-100 btn btn-primary btn-lg" type="submit">Submit</button>
                        </form>

                        <hr class="my-4">

                        <!-- Summary Report -->
                        <form onsubmit="return false" id="sumary-form">
                            <h4 class="mb-3">Sumary Report</h4>
                            <div class="row g-3">
                                <div class="col-sm-6">
                                    <label class="form-label">Total Flight Times (hrs : min)</label>
                                    <!-- <input type="number" class="form-control" id="date-from" required> -->
                                    <div class="row">
                                        <div class="col">
                                            <input type="number" class="form-control text-center" id="total_times_hours"
                                                required value="0" />
                                        </div>
                                        <p class="col-sm-1 text-center">:</p>
                                        <div class="col">
                                            <input type="number" class="form-control text-center" id="total_times_min"
                                                required value="0" />
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <label for="total_sector" class="form-label">Total Sector</label>
                                    <input type="number" class="form-control" id="total_sector" required value="0">
                                </div>
                                <div class="col-sm-6">
                                    <label for="total_working_day" class="form-label">Total Working Day</label>
                                    <input type="number" class="form-control" id="total_working_day" required value="0">
                                </div>
                                <div class="col-sm-6">
                                    <label for="total_layover_day" class="form-label">Total Layover Days</label>
                                    <input type="number" class="form-control" id="total_layover_day" required value="0">
                                </div>
                            </div>
                            <!-- <button class="w-100 btn btn-primary btn-lg" type="submit">Submit</button> -->
                            <br>
                        </form>

                        <!-- Setting -->
                        <form id="setting-form">
                            <h4 class="mb-3">Setting</h4>
                            <div class="row g-3">
                                <div class="col-sm-6">
                                    <label for="setting_basicSalary" class="form-label">Basic salary</label>
                                    <input type="number" class="form-control" id="setting_basicSalary" required
                                        value="12000">
                                </div>
                                <div class="col-sm-6">
                                    <label for="setting_productivity" class="form-label">Productivity</label>
                                    <input type="number" class="form-control" id="setting_productivity" required
                                        value="7000">
                                </div>
                                <div class="col-sm-6">
                                    <label for="setting_hours_0_70" class="form-label">Allowances Per Hours
                                        (0-70)</label>
                                    <input type="number" class="form-control" id="setting_hours_0_70" required
                                        value="200">
                                </div>
                                <div class="col-sm-6">
                                    <label for="setting_hours_above_70" class="form-label">Allowances Per Hours (above
                                        70)</label>
                                    <input type="number" class="form-control" id="setting_hours_above_70" required
                                        value="300">
                                </div>
                                <div class="col-sm-6">
                                    <label for="setting_sector" class="form-label">Allowances Per Sector</label>
                                    <input type="number" class="form-control" id="setting_sector" required value="200">
                                </div>
                                <div class="col-sm-6">
                                    <label for="setting_trans_meal" class="form-label">Transportationo ane Meal
                                        Allowances
                                        Per Day</label>
                                    <input type="number" class="form-control" id="setting_trans_meal" required
                                        value="550">
                                </div>
                                <div class="col-sm-6">
                                    <label for="setting_layover" class="form-label">Layover Allowances Per Day</label>
                                    <input type="number" class="form-control" id="setting_layover" required
                                        value="2300">
                                </div>

                            </div>
                            <!-- <button class="w-100 btn btn-primary btn-lg" type="submit">Submit</button> -->
                            <br>
                        </form>
                    </div>

                    <!-- Income -->
                    <div class="col-md-5 col-lg-4 ">
                        <h4 class="d-flex justify-content-between align-items-center mb-3">
                            <span class="text-primary" id="income">Income</span>
                        </h4>
                        <div class="list-group mb-3">
                            <li class="list-group-item d-flex justify-content-between lh-sm">
                                <div>
                                    <h6 class="my-0">Basic Salary</h6>
                                    <!-- <br> -->
                                </div>
                                <span class="text-body-secondary" id="income_basicSalary">0฿</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between lh-sm">
                                <div>
                                    <h6 class="my-0">Productivity Allowances</h6>
                                    <!-- <br> -->
                                </div>
                                <span class="text-body-secondary" id="income_productivity">0฿</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between lh-sm">
                                <div>
                                    <h6 class="my-0">Flight Hours Allowances</h6>
                                    <small class="text-body-secondary" id="incomm_flight_0_70">1-70 Hours (0฿)</small>
                                    <br>
                                    <small class="text-body-secondary" id="incomm_flight_above_70">above 70 Hours
                                        (0฿)</small>
                                </div>
                                <span class="text-body-secondary" id="income_flight">0฿</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between lh-sm">
                                <div>
                                    <h6 class="my-0">Sector Allowances</h6>
                                    <small id="income_sector_text">0 sec</small>
                                </div>
                                <span class="text-body-secondary" id="income_sector">0฿</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between lh-sm">
                                <div>
                                    <h6 class="my-0">Transportationo and Meal Allowances</h6>
                                    <small id="income_working_text">0 working days</small>
                                </div>
                                <span class="text-body-secondary" id="income_working">0฿</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between lh-sm">
                                <div>
                                    <h6 class="my-0">Layover Allowances</h6>
                                    <small id="income_layover_text">0 layover days</small>
                                </div>
                                <span class="text-body-secondary" id="income_layover">0฿</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between text-success">
                                <!-- <span>Total (THB)</span> -->
                                <h6 class="my-0">Total (THB)</h6>
                                <strong id="income_total">0฿</strong>
                            </li>
                            <br>
                            <span style="color: red;">* Not Include In-Flight Sale Commission Allowances</span>
                        </div>

                    </div>
                </div>
            </main>
            <br>

        </div>

        <div class="b-example-divider"></div>
        <!-- Report -->
        <div class="container table-responsive-sm ">
            <br>
            <h2>Report</h2>
            <br>
            <table class="table table-striped  table-bordered table-sm" id="tableReport">
                <!-- <thead class="table-info">
                    <tr>
                        <th scope="col">Date</th>
                        <th scope="col">Report</th>
                        <th scope="col">Flight Time</th>
                        <th scope="col">Sector(s)/Event(s)</th>
                    </tr>
                </thead>
                <tbody class="table-group-divider">
                    <tr>
                        <td>Sun 01-Oct</td>
                        <td>05:10</td>
                        <td>5:15</td>
                        <td>- 620 BKK 6:05 L SIN 9:30 L
                            <br>
                            - 621 SIN 10:41 L BKK 12:31 L
                        </td>
                    </tr>

                </tbody>
                <tfoot>
                    <!-- <tr>
                    <th>First</th>
                    <th>Last</th>
                    <th>Handle</th>
                </tr> 
                </tfoot>-->
            </table>
        </div>
    </div>

    <div class="page-loader flex-column bg-dark bg-opacity-25" id="loading" hidden>
        <div id="loading-span" class="containe">
            <div style="width: max-content; margin: auto;">
                <span class="spinner-border text-primary">></span>
            </div>
            <span class="text-gray-800 fs-6 fw-semibold mt-5">Loading...</span>
        </div>
    </div>




    <script>
        var dataReport = {}

        let selectDateForm = document.getElementById('select-date')
        selectDateForm.addEventListener("submit", (e) => {
            e.preventDefault();
            loading(true)
            let dateFromValue = document.getElementById("date-from").value
            let dateToValue = document.getElementById("date-to").value

            fetch("http://" + window.location.host + "/data" + `?from=${dateFromValue}&to=${dateToValue}`, {
                method: "GET",
            }).then((response) => {
                if (response.status == 200 || response.status == 304) {
                    return response.json()
                }
                else {
                    window.location.href = "http://" + window.location.host + '/login'
                }
            }).then(data => {
                writeSumaryReport(data)
                writeIncome()
                writeTable(data)
                loading(false)
            })
        })
        const loading = (state) => {
            document.getElementById('loading').hidden = !state
        }
        const writeSumaryReport = (data) => {
            document.getElementById('total_times_hours').value = data.total.flightTimes.hour
            document.getElementById('total_times_min').value = data.total.flightTimes.min
            document.getElementById('total_sector').value = data.total.sector
            document.getElementById('total_working_day').value = data.total.days
            document.getElementById('total_layover_day').value = data.total.layover
        }
        const writeTable = (data) => {
            console.log(data.tableHtml)
            document.getElementById("tableReport").innerHTML = data.tableHtml
        }
        const writeIncome = () => {

            let summary = {
                hour: parseInt(document.getElementById('total_times_hours').value),
                min: parseInt(document.getElementById('total_times_min').value),
                sectors: parseInt(document.getElementById('total_sector').value),
                workingDay: parseInt(document.getElementById('total_working_day').value),
                layover: parseInt(document.getElementById('total_layover_day').value),
            }
            let setting = {

                hours_0_70: parseInt(document.getElementById('setting_hours_0_70').value),
                hours_above_70: parseInt(document.getElementById('setting_hours_above_70').value),
                sector: parseInt(document.getElementById('setting_sector').value),
                workingDay: parseInt(document.getElementById('setting_trans_meal').value),
                layover: parseInt(document.getElementById('setting_layover').value),
            }

            let income = {
                basicSalary: parseInt(document.getElementById('setting_basicSalary').value),
                productivity: parseInt(document.getElementById('setting_productivity').value),
                flight: calculate_flight_income(),
                sector: summary.sectors * setting.sector,
                working: summary.workingDay * setting.workingDay,
                layover: summary.layover * setting.layover
            }
            let incomeTotal = 0
            for (let i in income) {
                incomeTotal += parseInt(income[i])
            }

            document.getElementById("income_basicSalary").innerHTML = toStringIncome(income.basicSalary)
            document.getElementById("income_productivity").innerHTML = toStringIncome(income.productivity)
            document.getElementById("income_flight").innerHTML = toStringIncome(income.flight)
            document.getElementById("income_sector").innerHTML = toStringIncome(income.sector)
            document.getElementById("income_working").innerHTML = toStringIncome(income.working)
            document.getElementById("income_layover").innerHTML = toStringIncome(income.layover)
            document.getElementById("income_total").innerHTML = toStringIncome(incomeTotal)

            document.getElementById("income_sector_text").innerHTML = summary.sectors + ' sec';
            document.getElementById("income_working_text").innerHTML = summary.workingDay + ' working days';
            document.getElementById('income_layover_text').innerHTML = summary.layover + ' layover days';

            function calculate_flight_income() {
                let result = 0
                let total_min = parseInt(summary.hour) * 60 + parseInt(summary.min)

                if (total_min > 70 * 60) {
                    let income1 = 70 * parseInt(setting.hours_0_70)
                    let income2 = parseInt((total_min - (70 * 60)) * parseInt(setting.hours_above_70) / 60)
                    result = income1 + income2
                    document.getElementById("incomm_flight_0_70").innerHTML = "1-70 Hours (" + toStringIncome(income1) + ")"
                    document.getElementById("incomm_flight_above_70").innerHTML = `above 70 Hours (${toStringIncome(income2)})`
                    document.getElementById("incomm_flight_above_70").hidden = false
                }
                else {
                    result += parseInt(total_min * parseInt(setting.hours_0_70) / 60)
                    document.getElementById("incomm_flight_0_70").innerHTML = `1-70 Hours (${toStringIncome(result)})`
                    document.getElementById("incomm_flight_above_70").hidden = true
                }
                return result
            }
            function toStringIncome(num) {
                num = String(num)
                return num.replace(/\B(?=(\d{3})+(?!\d))/g, ',') + '฿'
            }
        }


        let sumaryForm = document.getElementById('sumary-form')
        let settingForm = document.getElementById("setting-form")

        const onChangeInput = (e) => {
            writeIncome()
        }
        sumaryForm.onkeyup = onChangeInput
        settingForm.onkeyup = onChangeInput

        writeIncome()

        const onChangeDate = () => {
            let dateFromValue = document.getElementById("date-from").value
            let dateToValue = document.getElementById("date-to").value
            if (dateFromValue != '' && dateToValue != "") {
                if (new Date(dateFromValue) > new Date(dateToValue)) {
                    document.getElementById("date-from").value = dateToValue
                    document.getElementById("date-to").value = ''
                }
            }
        }
        document.getElementById("date-from").onchange = onChangeDate
        document.getElementById("date-to").onchange = onChangeDate

    </script>

</body>

</html>